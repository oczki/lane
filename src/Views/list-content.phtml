<?php
\Chibi\AssetViewDecorator::addStylesheet('list-content.css');
\Chibi\AssetViewDecorator::addScript('list-content.js');
\Chibi\AssetViewDecorator::addStylesheet('jquery.resizableColumns.css');
\Chibi\AssetViewDecorator::addScript('jquery.resizableColumns.min.js');
\Chibi\AssetViewDecorator::addStylesheet('jquery.tablesorter.custom.css');
\Chibi\AssetViewDecorator::addScript('jquery.tablesorter.min.js');

$alignments = [];
$alignments[ListColumn::ALIGN_LEFT] = 'col-left';
$alignments[ListColumn::ALIGN_CENTER] = 'col-center';
$alignments[ListColumn::ALIGN_RIGHT] = 'col-right';

if (!isset($this->context->list))
	return;

\Chibi\AssetViewDecorator::setTitle($this->context->user->name . '&rsquo;s lane&nbsp;&ndash; ' . $this->context->list->name);
if ($this->context->list->content->css != '')
	\Chibi\AssetViewDecorator::addStylesheet(\Chibi\UrlHelper::route('list', 'custom-css', ['userName' => $this->context->user->name, 'id' => $this->context->list->urlName]));
?>

<?= HtmlHelper::tag('table', [
	'id' => 'list',
	'data-resizable-columns-id' => $this->context->list->urlName,
	'data-can-edit' => $this->context->canEdit ? '1' : '0',
	'data-show-row-ids' => $this->context->list->content->showRowIds,
	'data-sort-style' => $this->context->list->content->sortStyle,
	'data-list-id' => $this->context->list->urlName,
	'data-list-rows' => json_encode($this->context->list->content->rows),
	'data-list-columns' => json_encode($this->context->list->content->columns),
	'data-last-content-id' => $this->context->list->content->lastContentId], false) ?>

	<thead>
		<tr>
			<?php foreach (ListService::getColumns($this->context->list) as $columnIndex => $column): ?>
				<?= HtmlHelper::tag('th', [
					'data-resizable-column-id' => $column->id,
					'class' => $alignments[$column->align],
					'style' => sprintf('width: %.02f%%', $column->width),
				], false) ?>
					<span>
						<?= htmlspecialchars($column->name) ?>
					</span>
				<?= HtmlHelper::tagClose('th') ?>
			<?php endforeach ?>
			<?php if ($this->context->canEdit): ?>
				<th data-noresize="1" class="row-ops"></th>
			<?php endif ?>
		</tr>
	</thead>

	<tbody>
	</tbody>

<?= HtmlHelper::tagClose('table') ?>

<?php if ($this->context->canEdit): ?>
	<div id="table-ops">
		<input type="button" id="add-row" value="Add new row"/>
		<input type="button" id="delete-rows" value="Delete selected"/>
	</div>
<?php endif ?>
